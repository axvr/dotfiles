#!/bin/sh

# Tmux project switcher.  Switch to and open projects as Tmux sessions.
# Based on: <https://github.com/ThePrimeagen/.dotfiles/blob/master/bin/.local/scripts/tmux-sessionizer>

project="$1"
if [ -z "$1" ]; then
    proj_root="$HOME/Projects"
    project="$(fd --base-directory "$proj_root" --exact-depth 1 \
                  --exclude Work --type d . . Work \
               | sed -e 's,^\./,,' -e 's,/$,,' \
               | fzf --layout=reverse --no-color --info=right)"
    [ -z "$project" ] && exit 1
    project="$proj_root/$project"
fi
[ -d "$project" ] || exit 1

session_name="$([ "$HOME" = "$project" ] && echo '>_ ' || basename "$project" | tr . _)"

tmux has-session -t "$session_name" 2> /dev/null \
    || tmux new-session -ds "$session_name" -c "$project"

[ -n "$TMUX" ] \
    && tmux switch-client  -t "$session_name" \
    || tmux attach-session -t "$session_name"
